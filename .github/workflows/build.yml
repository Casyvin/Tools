name: Build PLTools Application

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]

jobs:
  build-windows:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v3

      - name: Set up JDK 17
        uses: actions/setup-java@v3
        with:
          java-version: '17'
          distribution: 'temurin'

      - name: Setup JavaFX
        run: |
          echo "Downloading JavaFX SDK"
          curl -L -o javafx-sdk.zip https://download2.gluonhq.com/openjfx/17.0.6/openjfx-17.0.6_windows-x64_bin-sdk.zip
          unzip javafx-sdk.zip

      - name: Build with Maven
        run: mvn clean package

      - name: Create Windows executable
        run: |
          $env:PATH = $env:PATH + ";C:\Program Files\Java\jdk-17\bin"
          jpackage --input target/ --name PLTools --app-version 1.0 --main-class com.sws4cloud.pltools.PLToolsApplication --main-jar (Get-ChildItem target/*.jar | Where-Object { $_.Name -notlike "*sources*" -and $_.Name -notlike "*javadoc*" } | Select-Object -First 1).Name --type exe --win-shortcut --dest dist

      - name: Upload Windows artifact
        uses: actions/upload-artifact@v3
        with:
          name: PLTools-Windows
          path: dist/*.exe

  build-macos:
    runs-on: macos-latest
    steps:
      - uses: actions/checkout@v3

      - name: Set up JDK 17
        uses: actions/setup-java@v3
        with:
          java-version: '17'
          distribution: 'temurin'

      - name: Setup JavaFX
        run: |
          echo "Downloading JavaFX SDK"
          curl -L -o javafx-sdk.zip https://download2.gluonhq.com/openjfx/17.0.6/openjfx-17.0.6_osx-x64_bin-sdk.zip
          unzip javafx-sdk.zip

      - name: Build with Maven
        run: mvn clean package

      - name: Create macOS DMG
        run: |
          jpackage --input target/ --name PLTools --app-version 1.0 --main-class com.sws4cloud.pltools.PLToolsApplication --main-jar $(ls target/*.jar | grep -v sources | grep -v javadoc | head -n 1) --type dmg --dest dist

      - name: Upload macOS artifact
        uses: actions/upload-artifact@v3
        with:
          name: PLTools-macOS
          path: dist/*.dmg
